;
;       BOOT MODULE version 1.0 by Jari Tapio Tuominen.
;       Modified version of my 16bit kernel loader code.
;       (Contains only 16bit code)
;
                                ; Correct CS:IP - So that org 0x0100 works
                                jmp 0x7b0:0x105
begin:                          ;
                                ; Make a dummy stack (Microsoft style :-)
                                cli
                                xor cx,cx
                                mov ss,cx
                                mov ax,0x7b7c
                                mov sp,ax
                                sti

                                ;
                                puts str_loading

                                ;
                                ; Load whole bootsector
                                ; (head 0, track 0)
                                mov ax,0x07b0
                                mov es,ax
                                mov bx,0x0100
                                mov dx,0x0000
                                mov cx,0x0001
                                mov ax,0x0212
                                int 0x13

                                ; Load KERNEL module (head 1, track 0)
                                mov ax,0x0ff0
                                mov es,ax
                                mov bx,0x0100+(512*18 * 0)
                                mov dx,0x0100
                                mov cx,0x0001
                                mov ax,0x0212
                                int 0x13
                                ;
                                mov ax,0x0ff0 ; (head 0, track 1)
                                mov es,ax
                                mov bx,0x0100+(512*18 * 1)
                                mov dx,0x0000
                                mov cx,0x0101
                                mov ax,0x0212
                                int 0x13
                                ;
                                mov ax,0x0ff0 ; (head 1, track 1)
                                mov es,ax
                                mov bx,0x0100+(512*18 * 2)
                                mov dx,0x0100
                                mov cx,0x0101
                                mov ax,0x0212
                                int 0x13
                                ;
                                mov ax,0x0ff0 ; (head 0, track 2)
                                mov es,ax
                                mov bx,0x0100+(512*18 * 3)
                                mov dx,0x0000
                                mov cx,0x0201
                                mov ax,0x0212
                                int 0x13
                                ;
                                mov ax,0x0ff0 ; (head 1, track 2)
                                mov es,ax
                                mov bx,0x0100+(512*18 * 4)
                                mov dx,0x0100
                                mov cx,0x0201
                                mov ax,0x0212
                                int 0x13

				; So the max. size of the kernel is 54K.

                                ;
                                puts str_loaded
